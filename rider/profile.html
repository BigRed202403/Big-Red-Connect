<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Rider Profile — Big Red Connect</title>

  <link rel="apple-touch-icon" href="../icon.PNG">
  <link rel="icon" type="image/png" href="../icon.PNG">
  <meta name="theme-color" content="#000000">

  <style>
    :root {
      --red:#b30000;
      --bg:#000;
      --panel:#111;
      --border:#222;
      --muted:#aaa;
    }

    body {
      margin:0;
      background:#000;
      color:#fff;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    }

    header {
      padding:14px;
      background:#000;
      border-bottom:2px solid var(--red);
      display:flex;
      align-items:center;
      gap:12px;
      position:sticky;
      top:0;
      z-index:10;
    }

    header img { height:42px; }

    h1 {
      text-align:center;
      margin:20px 0 10px;
      font-size:1.7rem;
      color:#fff;
    }

    .desc {
      text-align:center;
      color:var(--muted);
      margin-bottom:18px;
      font-size:.9rem;
    }

    .panel {
      background:#111;
      border:1px solid #222;
      padding:16px;
      margin:0 14px 20px;
      border-radius:12px;
    }

    label {
      display:block;
      margin-top:14px;
      font-size:.85rem;
      font-weight:600;
      color:#ddd;
    }

    input, textarea, select {
      width:100%;
      margin-top:6px;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #333;
      background:#000;
      color:#fff;
      font-size:.95rem;
    }

    textarea {
      min-height:70px;
      resize:none;
    }

    .btn {
      width:100%;
      background:var(--red);
      color:#fff;
      padding:12px;
      border:none;
      border-radius:10px;
      font-size:1rem;
      margin-top:18px;
      font-weight:700;
      cursor:pointer;
    }

    .btn-secondary {
      background:#111;
      border:1px solid #333;
      margin-top:10px;
      color:#fff;
    }

    #toast {
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      background:#111;
      border:1px solid var(--red);
      padding:12px 18px;
      border-radius:999px;
      opacity:0;
      pointer-events:none;
      transition:opacity .25s;
      z-index:999;
    }
    #toast.show { opacity:1; }
  </style>
</head>
<body>

<header>
  <a href="../index.html">
    <img src="../official_logo_Nov.png">
  </a>
  <div style="font-size:1.1rem;font-weight:700;">Rider Profile</div>
</header>

<h1>Your Rider Profile</h1>
<p class="desc">Save your details for faster ride requests.</p>

<div class="panel">

  <label>Your Name</label>
  <input id="name">

  <label>Mobile Number</label>
  <input id="phone" disabled style="opacity:.6;">

  <label>Home / Usual Pickup Address</label>
  <input id="homeAddress" placeholder="Optional">

  <label>Gate Code / Access Notes</label>
  <input id="gateCode" placeholder="Optional">

  <label>Rider Notes (private)</label>
  <textarea id="notes" placeholder="Optional"></textarea>

  <label>Default Party Size</label>
  <select id="partySize">
    <option value="1">1 passenger</option>
    <option value="2">2 passengers</option>
    <option value="3">3 passengers</option>
    <option value="4">4 passengers</option>
    <option value="5">5 passengers</option>
    <option value="6">6 passengers</option>
  </select>

  <button class="btn" id="btnSave">Save Profile</button>
  <button class="btn btn-secondary" onclick="window.location='rider.html'">← Back to Rider Hub</button>

</div>

<div id="toast"></div>

<script>
const API = "https://bigred-bookings.bigredtransportation.workers.dev";

function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1800);
}

function getPhone(){
  return localStorage.getItem("riderPhone") || "";
}

async function loadProfile(){
  const phone = getPhone();
  if(!phone){
    showToast("Missing phone. Login again.");
    setTimeout(()=>window.location="../rider-login.html",1500);
    return;
  }
  document.getElementById("phone").value = phone;

  const res = await fetch(`${API}/api/rider/profile?phone=${encodeURIComponent(phone)}`);
  if(!res.ok){
    showToast("No profile saved yet.");
    return;
  }
  const p = await res.json();

  document.getElementById("name").value = p.name || "";
  document.getElementById("homeAddress").value = p.homeAddress || "";
  document.getElementById("gateCode").value = p.gateCode || "";
  document.getElementById("notes").value = p.notes || "";
  document.getElementById("partySize").value = p.defaultPartySize || 1;
}

async function saveProfile(){
  const phone = getPhone();
  const payload = {
    phone,
    name: document.getElementById("name").value.trim(),
    homeAddress: document.getElementById("homeAddress").value.trim(),
    gateCode: document.getElementById("gateCode").value.trim(),
    notes: document.getElementById("notes").value.trim(),
    defaultPartySize: Number(document.getElementById("partySize").value)
  };

  const res = await fetch(`${API}/api/rider/profile`,{
    method:"PUT",
    headers:{ "Content-Type":"application/json"},
    body:JSON.stringify(payload)
  });

  if(res.ok){
    showToast("Profile saved!");
    setTimeout(()=>window.location="rider.html",1200);
  } else {
    showToast("Save failed.");
  }
}

document.getElementById("btnSave").addEventListener("click", saveProfile);

loadProfile();
</script>

</body>
</html>