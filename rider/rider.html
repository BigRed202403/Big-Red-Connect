<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Big Red Connect — Rider Hub</title>

  <link rel="apple-touch-icon" href="../icon.PNG">
  <link rel="icon" type="image/png" sizes="192x192" href="../icon.PNG">
  <link rel="manifest" href="../manifest.json">
  <meta name="theme-color" content="#000000">

  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    header {
      padding: 18px;
      text-align: center;
      border-bottom: 2px solid #b30000;
    }

    header img {
      width: 130px;
      border-radius: 6px;
    }

    .container {
      padding: 25px 18px;
      max-width: 500px;
      margin: auto;
    }

    .section-title {
      font-size: 1.1rem;
      margin-bottom: 22px;
      text-align: center;
      color: #ddd;
      font-weight: 600;
    }

    .btn {
      width: 100%;
      background: #b30000;
      color: #fff;
      font-size: 1rem;
      padding: 15px;
      margin-bottom: 15px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-secondary {
      background: #111;
      border: 1px solid #333;
      color: #fff;
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      color: #777;
      font-size: .85rem;
    }
  </style>
</head>

<body>

<header>
  <img src="../official_logo_Nov.png" alt="Big Red Connect Logo">
</header>

<div class="container">

  <div class="section-title">Welcome to Your Rider Hub</div>

  <button class="btn" onclick="goTo('ride-request.html')">
    Request a Ride
  </button>

  <button class="btn" onclick="goTo('myride.html')">
    My Ride
  </button>

  <button class="btn" onclick="goTo('profile.html')">
    My Profile
  </button>

  <button class="btn btn-secondary" onclick="logout()">
    Log Out
  </button>

</div>

<div class="footer">Veteran Owned • Affordable • Local • Trusted.</div>

<script>
/* ==========================================================
   INITIAL LOAD — confirm rider profile exists
   Loads profile into localStorage + auto-creates missing
========================================================== */

const PROFILE_API = "https://bigred-profile.bigredtransportation.workers.dev/api/profile";

async function loadProfile() {
  const phone = localStorage.getItem("riderPhone");

  if (!phone) {
    window.location.href = "../rider-login.html";
    return;
  }

  try {
    const res = await fetch(`${PROFILE_API}?riderPhone=${encodeURIComponent(phone)}`);
    if (res.ok) {
      const data = await res.json();
      localStorage.setItem("riderProfile", JSON.stringify(data));
    } else {
      // Auto-create blank profile if missing
      await fetch(PROFILE_API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ riderPhone: phone })
      });

      const res2 = await fetch(`${PROFILE_API}?riderPhone=${encodeURIComponent(phone)}`);
      if (res2.ok) {
        const data = await res2.json();
        localStorage.setItem("riderProfile", JSON.stringify(data));
      }
    }
  } catch (err) {
    // No debug logs per production rules
  }
}

loadProfile();

/* ==========================================================
   NAVIGATION
========================================================== */
function goTo(page) {
  window.location.href = page;
}

/* ==========================================================
   LOG OUT
========================================================== */
function logout() {
  localStorage.removeItem("riderPhone");
  localStorage.removeItem("riderProfile");
  window.location.href = "../rider-login.html";
}
</script>

</body>
</html>