<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Big Red Rider Hub</title>

<!-- PWA / Icons -->
<link rel="apple-touch-icon" href="/icon.PNG">
<link rel="icon" type="image/png" sizes="192x192" href="/icon.png">
<link rel="shortcut icon" href="/icon.PNG">
<link rel="manifest" href="/manifest-rider.json">
<meta name="apple-mobile-web-app-title" content="Big Red Rider">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#000000">

<link rel="stylesheet" href="/style.css">

<style>
  /* Local enhancements */
  .btn-stack { display:flex; flex-direction:column; gap:12px; margin-top:16px; }
  #toast {
    position:fixed;
    bottom:24px;
    left:50%;
    transform:translateX(-50%);
    background:#b30000;
    color:white;
    padding:10px 16px;
    border-radius:8px;
    opacity:0;
    transition:opacity .3s;
    z-index:9999;
  }
  #toast.show { opacity:1; }

  /* Phone validation highlight */
  .invalid {
    border-color:#ff4444 !important;
    background:#220000 !important;
  }

  /* Save checkmark animation */
  #saveCheck {
    opacity:0;
    font-size:1.3rem;
    color:#00cc66;
    transition:opacity .4s;
    margin-left:6px;
  }
  #saveCheck.show { opacity:1; }
</style>

</head>
<body>

<header class="topbar">
  <a href="/index.html" class="home-link">üè† Home</a>
  <span style="color:#fff;font-weight:700;">Rider Hub</span>
</header>

<main style="max-width:480px; margin:auto; padding:16px;">

<h1>Your Rider Hub</h1>
<p class="tagline">Save your details once ‚Äî request flat-rate rides anytime.</p>

<!-- ======================================
     PROFILE CARD
======================================= -->
<section class="card" id="profile-card">
  <h2>Rider Profile</h2>
  <form id="profileForm">

    <label for="riderName">Your Name</label>
    <input id="riderName" type="text" autocomplete="name" placeholder="First name or nickname">

    <label for="riderPhone">Mobile Number</label>
    <input id="riderPhone" type="tel" autocomplete="tel"
           placeholder="(405) 378-4024 or +14053784024">

    <label for="riderHome">Home / Usual Pickup (optional)</label>
    <input id="riderHome" type="text" placeholder="Neighborhood or full address">

    <div class="btn-row" style="margin-top:14px;">
      <button type="submit" class="btn-primary">üíæ Save Changes</button>
      <button type="button" id="clearProfile" class="btn-ghost">üßπ Reset</button>
    </div>

    <div class="hint" style="margin-top:12px;">
      Your **mobile number** becomes your Rider ID so Big Red can match you to your rides.
    </div>

    <div id="profileStatus" class="meta" style="margin-top:10px;"></div>
    <span id="saveCheck">‚úì Saved</span>
  </form>
</section>

<!-- ======================================
     ACTIONS (STACKED BUTTONS)
======================================= -->
<section class="card">
  <h2>Ride Actions</h2>

  <div class="btn-stack">
    <a href="/rider/ride-request.html" class="btn-primary">üìù Request a Ride</a>
    <a href="/rider/myride.html" class="btn-secondary">üìç View My Ride</a>
    <a href="/rider-login.html?logout=true" class="btn-secondary">üö™ Logout</a>
  </div>

  <div id="profileStatus2" class="meta"></div>
</section>

<section class="card">
  <h2>Notifications</h2>
  <p class="hint">Push alerts for ride updates coming soon.</p>
</section>

</main>

<footer>
  ¬© 2025 Big Red Connect ‚Äî Local. Affordable. Trusted.
</footer>

<div id="toast"></div>

<script>
/* ========================================================
   RIDER PROFILE ‚Äî FULL PATCH + ENHANCEMENTS
======================================================== */
const STORAGE_KEY = "bigred_rider_profile_v1";
const riderNameInput  = document.getElementById("riderName");
const riderPhoneInput = document.getElementById("riderPhone");
const riderHomeInput  = document.getElementById("riderHome");
const profileForm     = document.getElementById("profileForm");
const clearBtn        = document.getElementById("clearProfile");
const profileStatus   = document.getElementById("profileStatus");
const profileStatus2  = document.getElementById("profileStatus2");
const saveCheck       = document.getElementById("saveCheck");

/* -------------------------
   Toast
------------------------- */
function showToast(msg, ms = 2000) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), ms);
}

/* -------------------------
   Load Profile
------------------------- */
function loadProfile() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) {
    profileStatus.textContent = "Profile not saved yet.";
    profileStatus2.textContent = "";
    return;
  }
  try {
    const p = JSON.parse(raw);
    riderNameInput.value  = p.name  || "";
    riderPhoneInput.value = p.phone || "";
    riderHomeInput.value  = p.home  || "";
    profileStatus.textContent  = `Loaded profile for ${p.name || "rider"}.`;
    profileStatus2.textContent = `Logged in as ${p.phone || "unknown"}`;
  } catch {
    profileStatus.textContent = "Profile not saved yet.";
    profileStatus2.textContent = "";
  }
}

/* -------------------------
   Normalize phone ‚Üí +1xxxxxxxxxx
------------------------- */
function normalizePhone(phone) {
  if (!phone) return null;
  phone = phone.trim();

  if (phone.startsWith("+")) {
    const d = phone.slice(1).replace(/\D/g, "");
    return d ? "+" + d : null;
  }

  const d = phone.replace(/\D/g, "");
  if (!d) return null;

  if (d.length === 10) return "+1" + d;
  if (d.length === 11 && d.startsWith("1")) return "+" + d;

  return "+" + d;
}

/* -------------------------
   Validate phone live
------------------------- */
riderPhoneInput.addEventListener("input", () => {
  const n = normalizePhone(riderPhoneInput.value);
  if (!n) riderPhoneInput.classList.add("invalid");
  else riderPhoneInput.classList.remove("invalid");
});

/* -------------------------
   Save Profile
------------------------- */
function saveProfile(e) {
  e.preventDefault();

  const name  = riderNameInput.value.trim();
  const phone = riderPhoneInput.value.trim();
  const home  = riderHomeInput.value.trim();

  const normalized = normalizePhone(phone);
  if (!normalized) {
    riderPhoneInput.classList.add("invalid");
    showToast("Please enter a valid mobile number.");
    return;
  }

  const profile = { name, phone: normalized, home };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
  localStorage.setItem("bigred_rider_id_e164", normalized);

  riderPhoneInput.classList.remove("invalid");
  profileStatus.textContent  = `Profile saved for ${name || "rider"} (${normalized}).`;
  profileStatus2.textContent = `Logged in as ${normalized}`;

  // Checkmark animation
  saveCheck.classList.add("show");
  setTimeout(() => saveCheck.classList.remove("show"), 1500);

  // Toast
  showToast("Profile saved!");
}

/* -------------------------
   Clear Profile
------------------------- */
function clearProfileData() {
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem("bigred_rider_id_e164");

  riderNameInput.value = "";
  riderPhoneInput.value = "";
  riderHomeInput.value = "";

  profileStatus.textContent = "Profile cleared.";
  profileStatus2.textContent = "";
  showToast("Profile cleared");
}

/* -------------------------
   INIT
------------------------- */
document.addEventListener("DOMContentLoaded", loadProfile);
profileForm.addEventListener("submit", saveProfile);
clearBtn.addEventListener("click", clearProfileData);
</script>

</body>
</html>