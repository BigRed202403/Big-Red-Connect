<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rider Login â€“ Big Red Connect</title>

<link rel="apple-touch-icon" href="/icon.PNG">
<link rel="icon" type="image/png" sizes="192x192" href="/icon.png">
<link rel="shortcut icon" href="/icon.PNG">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#000">

<link rel="stylesheet" href="/style.css?v=1" />

<style>
  body {
    background:#000;
    color:#fff;
    padding:0;
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }
  .login-wrap {
    max-width:420px;
    margin:40px auto;
    background:#111;
    border:1px solid #222;
    border-radius:12px;
    padding:24px;
    box-shadow:0 2px 12px rgba(0,0,0,0.4);
  }
  h1 {
    font-size:1.6rem;
    margin-bottom:6px;
    text-align:center;
    color:#ff1a1a;
  }
  p.tag {
    text-align:center;
    color:#bbb;
    font-size:.95rem;
    margin-bottom:20px;
  }
  label {
    display:block;
    color:#ccc;
    margin:10px 0 4px;
    font-size:.9rem;
  }
  input {
    width:100%;
    padding:12px;
    border-radius:8px;
    background:#000;
    color:#fff;
    border:1px solid #333;
    font-size:1rem;
  }
  button {
    width:100%;
    margin-top:22px;
    padding:14px;
    border:none;
    border-radius:8px;
    background:#b30000;
    color:#fff;
    font-weight:700;
    font-size:1.05rem;
    cursor:pointer;
  }
  button:active {
    transform:scale(.97);
  }
  .hint {
    text-align:center;
    font-size:.85rem;
    color:#777;
    margin-top:12px;
  }
  .logo-top {
    display:block;
    margin:40px auto 10px;
    width:110px;
  }
</style>

</head>
<body>

<img src="/icon.PNG" class="logo-top" alt="Big Red Logo">

<div class="login-wrap">
  <h1>Rider Login</h1>
  <p class="tag">Enter your mobile number to continue</p>

  <form id="loginForm">
    <label for="riderPhone">Mobile Number</label>
    <input id="riderPhone" type="tel" inputmode="numeric" placeholder="405-555-1234" />

    <button type="submit">Continue</button>
  </form>

  <p class="hint">Your number becomes your Rider ID for all ride requests.</p>
</div>

<script>
  const loginForm = document.getElementById("loginForm");
  const phoneInput = document.getElementById("riderPhone");

  /* Get redirect target */
  const params = new URL(location.href).searchParams;
  const next = params.get("next") || "hub";
  const prefillAddress = params.get("address") || "";

  function normalizePhone(p) {
    p = p.replace(/\D+/g, ""); // digits only
    if (p.length === 10) return "+1" + p;
    if (p.length === 11 && p.startsWith("1")) return "+" + p;
    return "+1" + p; // fallback
  }

  function saveProfile(phone) {
    const profile = {
      name: "",
      home: "",
      phone
    };
    localStorage.setItem("bigred_rider_profile_v1", JSON.stringify(profile));
    localStorage.setItem("bigred_rider_id", phone);
  }

  loginForm.addEventListener("submit", e => {
    e.preventDefault();
    let rawPhone = phoneInput.value.trim();
    if (!rawPhone) {
      alert("Please enter your mobile number.");
      return;
    }

    const phone = normalizePhone(rawPhone);
    saveProfile(phone);

    /* Routing Logic */
    if (next === "request") {
      window.location.href = "/rider/rider.html";
      return;
    }

    if (next === "ride-from-search" && prefillAddress) {
      window.location.href =
        "/rider/ride-request.html?dropoff=" + encodeURIComponent(prefillAddress);
      return;
    }

    /* default: go to rider hub */
    window.location.href = "/rider/rider.html";
  });
</script>

</body>
</html>