<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Track My Ride (Beta) ‚Äì Big Red Connect</title>

  <!-- No-cache -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <link rel="stylesheet" href="style.css" />

  <style>
    #map {
      height: 480px;
      width: 100%;
      border: 2px solid #b30000;
      border-radius: 10px;
      margin-top: 10px;
    }
    #status-box {
      margin-top: 20px;
      padding: 10px;
      border-radius: 8px;
      background: #111;
      color: #ccc;
      text-align: center;
      font-size: 1em;
    }
    .home-top {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
  </style>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMM0dxLNM7XQI5G3OBSnINeO5hcS3Ks5I"></script>
</head>
<body>

  <div class="logo-header">
    <img src="official_logo.jpeg" alt="Big Red Connect Logo" />
    <div class="home-top">
      <a href="index.html" class="btn secondary">üè† Home</a>
    </div>
  </div>

  <h1 style="color:red;">Track My Ride (Beta)</h1>
  <p class="tagline">Follow Big Red‚Äôs live location ‚Äî local, affordable, trusted.</p>

  <!-- Live status pill -->
  <div id="status-pill" class="status status--loading">Checking status‚Ä¶</div>

  <section class="info-section">
    <div id="map"></div>
    <div id="status-box">Loading map‚Ä¶</div>
  </section>

  <footer>
    <p>&copy; 2025 Big Red Connect ‚Äî <a href="index.html">Return Home</a></p>
  </footer>

  <script src="status.js"></script>

  <script>
    const LOCATION_URL = "https://update-location.bigredtransportation.workers.dev/";
    let map, marker;

    async function initMap() {
      const mapEl = document.getElementById("map");
      const statusBox = document.getElementById("status-box");
      map = new google.maps.Map(mapEl, {
        center: { lat: 35.4676, lng: -97.5164 }, // OKC default
        zoom: 11,
        mapTypeControl: false,
        streetViewControl: false
      });

      marker = new google.maps.Marker({
        map,
        title: "Big Red",
        icon: {
          url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png",
          scaledSize: new google.maps.Size(40, 40)
        }
      });

      await updateLocation();
      setInterval(updateLocation, 30000); // refresh every 30 seconds

      statusBox.textContent = "Live tracking active ‚Äî updating every 30 seconds.";
    }

    async function updateLocation() {
      try {
        const res = await fetch(LOCATION_URL + "?t=" + Date.now(), { cache: "no-store" });
        const data = await res.json();
        if (!data.latitude || !data.longitude) throw new Error("Invalid data");

        const pos = { lat: data.latitude, lng: data.longitude };
        marker.setPosition(pos);
        map.setCenter(pos);
      } catch (err) {
        console.error("Location update failed:", err);
        document.getElementById("status-box").textContent = "‚ö†Ô∏è Unable to load live location.";
      }
    }

    window.onload = initMap;
  </script>
</body>
</html>