<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Big Red Admin (BETA)</title>

<!-- PWA Icons -->
<link rel="apple-touch-icon" href="icon.PNG">
<link rel="icon" type="image/png" sizes="192x192" href="icon.PNG">
<link rel="shortcut icon" href="icon.PNG">
<link rel="manifest" href="manifest-admin-beta.json">
<meta name="theme-color" content="#000">

<!-- No Cache -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<!-- Diagnostic OneSignal Loader -->
<script>
  window.OneSignalLoaded = false;
  window.OneSignalDeferred = window.OneSignalDeferred || [];

  (function() {
    const sdk = document.createElement("script");
    sdk.src = "https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js";
    sdk.async = false;
    sdk.onload = function() {
      window.OneSignalLoaded = true;
      document.getElementById("statusLine").textContent =
        "SDK loaded â€” initializingâ€¦";
    };
    sdk.onerror = function() {
      document.getElementById("statusLine").textContent =
        "ERROR: OneSignal SDK failed to load";
    };
    document.head.appendChild(sdk);
  })();
</script>

<script>
  OneSignalDeferred.push(async function(OneSignal){
    try {
      await OneSignal.init({
        appId: "9b8bcc89-87d3-46e2-b2d0-042d1a267718",
        safari_web_id: "web.onesignal.auto.0c90051e-4735-447d-b203-75e3767d91b9",
        notifyButton: { enable: false },
        serviceWorkerPath: "/OneSignalSDKWorker.js",
        path: "/"
      });

      await OneSignal.sendTag("env","beta");
      await OneSignal.sendTag("role_admin_beta","true");

      const perm = await OneSignal.Notifications.getPermissionStatus();
      document.getElementById("statusLine").textContent =
        "Status: initialized â€¢ permission = " + perm;

    } catch(e) {
      console.warn("INIT ERROR:", e);
      document.getElementById("statusLine").textContent =
        "Status: error initializing OneSignal";
      document.getElementById("errorDetails").textContent =
        "Details: " + (e?.message || e);
    }
  });
</script>

<style>
  :root {
    --red:#b30000;
    --bg:#000;
    --panel:#111;
    --muted:#aaa;
  }
  body { background:#000; color:white; margin:0; font-family:-apple-system; }
  header { padding:12px 16px; border-bottom:2px solid var(--red); display:flex; justify-content:space-between; }
  .logo { height:40px; }
  .beta-pill { background:var(--red); padding:4px 10px; border-radius:999px; }
  main { max-width:640px; margin:20px auto; padding:0 16px; }
  .card { background:#111; padding:16px; border-radius:10px; border:1px solid #222; margin-bottom:14px; }
  button { padding:10px 16px; border-radius:8px; border:none; background:#b30000; color:white; font-weight:700; cursor:pointer; }
  #statusLine { margin-top:6px; color:#aaa; }
  #errorDetails { margin-top:4px; color:#ffcc66; font-size:0.8rem; white-space:pre-wrap; }
</style>
</head>

<body>

<header>
  <div style="display:flex; align-items:center; gap:10px;">
    <img src="icon.PNG" class="logo">
    <div>
      <div style="font-weight:700;">Big Red Admin</div>
      <div style="color:#aaa; font-size:0.8rem;">BETA Tag Console</div>
    </div>
  </div>
  <span class="beta-pill">BETA</span>
</header>

<main>
  <section class="card">
    <h1>Admin Push Tag (BETA)</h1>
    <p>
      This tags your device as an <strong>Admin (BETA)</strong> device for safe push testing.
    </p>

    <button id="btnEnable">ðŸ”” Enable Admin BETA Alerts</button>

    <div id="statusLine">Status: not initialized</div>
    <div id="errorDetails"></div>
  </section>
</main>

<script>
  const statusLine = document.getElementById("statusLine");
  const errorDetails = document.getElementById("errorDetails");
  const btnEnable = document.getElementById("btnEnable");

  btnEnable.addEventListener("click", () => {
    OneSignalDeferred.push(async function(OneSignal){
      try {
        const current = await OneSignal.Notifications.getPermissionStatus();
        if (current === "granted") {
          statusLine.textContent = "Status: permission already granted";
          return;
        }
        const result = await OneSignal.Notifications.requestPermission();
        statusLine.textContent = "Status: permission = " + result;
      } catch (e) {
        statusLine.textContent = "Status: error requesting permission";
        errorDetails.textContent = "Details: " + (e?.message || e);
      }
    });
  });
</script>

</body>
</html>