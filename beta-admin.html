<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Big Red Admin (BETA)</title>

<!-- ðŸ“± PWA / Icons -->
<link rel="apple-touch-icon" href="icon.PNG">
<link rel="icon" type="image/png" sizes="192x192" href="icon.PNG">
<link rel="shortcut icon" href="icon.PNG">
<!-- BETA admin manifest -->
<link rel="manifest" href="manifest-admin-beta.json">
<meta name="apple-mobile-web-app-title" content="Big Red Admin BETA">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="theme-color" content="#000">

<!-- ðŸš« Disable cache (BETA) -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<!-- ðŸ”” OneSignal v16 -->
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
</script>

<style>
  :root {
    --red:#b30000;
    --bg:#000;
    --panel:#111;
    --muted:#aaa;
  }
  *{box-sizing:border-box;}
  body{
    background:var(--bg);
    color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    margin:0;
  }
  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 16px;
    border-bottom:2px solid var(--red);
    background:#000;
  }
  .logo { height:36px; border-radius:4px; }
  .beta-pill{
    padding:4px 10px;
    border-radius:999px;
    background:var(--red);
    color:#fff;
    font-size:.75rem;
    font-weight:700;
  }
  main{
    max-width:640px;
    margin:18px auto;
    padding:0 16px 40px;
  }
  .card{
    background:var(--panel);
    border-radius:10px;
    border:1px solid #222;
    padding:14px 12px;
    margin-bottom:12px;
  }
  h1{
    margin:10px 0 4px;
    font-size:1.4rem;
  }
  p{font-size:.9rem;line-height:1.4;}
  button{
    padding:10px 16px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-weight:700;
  }
  .btn-primary{background:var(--red);color:#fff;}
  .btn-ghost{background:#000;color:#fff;border:1px solid #444;}
  #statusLine{
    font-size:.85rem;
    color:var(--muted);
    margin-top:4px;
  }
  #toast{
    position:fixed;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    background:#111;
    border:1px solid var(--red);
    padding:8px 16px;
    border-radius:999px;
    opacity:0;
    pointer-events:none;
    transition:opacity .25s;
    z-index:20;
    font-size:.85rem;
  }
  #toast.show{opacity:1;}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:8px;">
    <img src="icon.PNG" class="logo" alt="Big Red" />
    <div>
      <div style="font-weight:700;font-size:.9rem;">Big Red Admin</div>
      <div style="font-size:.75rem;color:#aaa;">BETA Tag Console</div>
    </div>
  </div>
  <span class="beta-pill">BETA</span>
</header>

<main>
  <section class="card">
    <h1>Admin Push Tag (BETA)</h1>
    <p>
      This page tags this device as an <strong>Admin (BETA)</strong> device
      so you can safely test OneSignal pushes using the <code>env = "beta"</code>
      and <code>role_admin_beta = "true"</code> tags, without touching live riders or drivers.
    </p>

    <button id="btnEnable" class="btn-primary">ðŸ”” Enable Admin BETA Alerts</button>

    <div id="statusLine">Status: not initialized</div>
  </section>

  <section class="card">
    <h2 style="margin:4px 0 6px;font-size:1rem;">How to test</h2>
    <ol style="font-size:.85rem;margin-left:18px;">
      <li>Tap <strong>Enable Admin BETA Alerts</strong> and allow notifications.</li>
      <li>In OneSignal dashboard, create a segment with tags:<br>
        <code>env = "beta"</code> AND <code>role_admin_beta = "true"</code>.
      </li>
      <li>Send a test push to that segment, or use your beta-push worker.</li>
    </ol>
  </section>
</main>

<div id="toast"></div>

<script>
  const statusLine = document.getElementById("statusLine");
  const toastEl = document.getElementById("toast");
  const btnEnable = document.getElementById("btnEnable");

  function showToast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 2000);
  }

  // Initialize OneSignal and tag as Admin BETA
  OneSignalDeferred.push(async function(OneSignal){
    try{
      await OneSignal.init({
        appId: "9b8bcc89-87d3-46e2-b2d0-042d1a267718",
        safari_web_id: "web.onesignal.auto.0c90051e-4735-447d-b203-75e3767d91b9",
        notifyButton: { enable: false },
        serviceWorkerPath: "/OneSignalSDKWorker.js"
        path: "/"
      });

      // Apply admin beta tags
      await OneSignal.sendTag("env","beta");
      await OneSignal.sendTag("role_admin_beta","true");

      const perm = await OneSignal.Notifications.getPermissionStatus();
      statusLine.textContent = "Status: initialized â€¢ permission = " + perm;

      console.log("[BETA Admin] OneSignal initialized and tagged.");
    }catch(e){
      console.warn("[BETA Admin] init error:", e);
      statusLine.textContent = "Status: error initializing OneSignal";
    }
  });

  // Click â†’ request permission if needed
  btnEnable.addEventListener("click", () => {
    OneSignalDeferred.push(async function(OneSignal){
      try{
        const current = await OneSignal.Notifications.getPermissionStatus();
        if(current === "granted"){
          showToast("Already enabled.");
          statusLine.textContent = "Status: permission already granted";
          return;
        }

        const result = await OneSignal.Notifications.requestPermission();
        const granted = result === "granted";
        showToast(granted ? "Alerts enabled!" : "Permission denied.");
        statusLine.textContent = "Status: permission = " + result;

      }catch(e){
        console.warn("[BETA Admin] Permission request error:", e);
        showToast("Error requesting permission.");
      }
    });
  });
</script>

</body>
</html>