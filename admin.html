<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Big Red</title>

<!-- Icons / PWA basics -->
<link rel="apple-touch-icon" href="icon.PNG">
<link rel="icon" type="image/png" sizes="192x192" href="icon.png">
<link rel="shortcut icon" href="icon.PNG">
<link rel="manifest" href="manifest-admin.json">
<meta name="apple-mobile-web-app-title" content="Big Red Admin">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="theme-color" content="#000">
<meta http-equiv="Cache-Control" content="no-store" />

<style>
:root {
  --red:#b30000;
  --bg:#000;
  --panel:#111;
  --muted:#aaa;
}

*{box-sizing:border-box;}

body{
  background:var(--bg);
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  margin:0;
  text-align:center;
}

/* Header */
header{
  background:var(--panel);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 16px;
  border-bottom:2px solid var(--red);
}
.bar-left{
  color:#bbb;
  font-size:.92em;
  display:flex;
  gap:10px;
  align-items:center;
}
.pill{
  padding:4px 10px;
  border-radius:999px;
  font-weight:700;
  font-size:.85em;
}
.pill.online{background:#064;}
.pill.away{background:#665500;}
.pill.offline{background:#400;}

.refresh-btn{
  background:#000;
  color:#fff;
  border:2px solid var(--red);
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  box-shadow:0 0 6px rgba(0,0,0,.6);
}
.refresh-btn:hover{background:#181818;}

h1{
  margin:18px 0 4px;
  color:var(--red);
  font-size:1.6rem;
}
.tagline{
  color:#ddd;
  margin:0 0 8px;
  font-size:.95rem;
}

/* Status pill under header */
#status-pill{
  margin:10px auto 12px;
  padding:10px 14px;
  border-radius:18px;
  display:inline-block;
  min-width:280px;
  font-size:.9rem;
  background:#222;
  border:1px solid #333;
}
#status-pill.online{background:#064;}
#status-pill.away{background:#665500;}
#status-pill.offline{background:#400;}

/* Layout */
.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:18px;
  max-width:960px;
  margin:0 auto;
  padding:10px 16px 24px;
}
section{
  background:var(--panel);
  border:1px solid #222;
  border-radius:8px;
  padding:14px 12px 16px;
  text-align:left;
}
section h2{
  margin:6px 0 8px;
  font-size:1.1rem;
  border-bottom:1px solid #222;
  padding-bottom:4px;
}

/* Inputs / buttons */
select,button,input,textarea{font-family:inherit;}
select,button,input[type="text"],input[type="url"]{
  padding:8px 10px;
  border-radius:6px;
  border:none;
  margin:4px 0;
  font-weight:600;
  font-size:.95rem;
}
button{cursor:pointer;}

.btn-primary{
  background:var(--red);
  color:#fff;
}
.btn-secondary{
  background:#000;
  color:#fff;
  border:1px solid var(--red);
}
.btn-tertiary{
  background:#222;
  color:#fff;
  border:1px solid #555;
}

.row{
  display:flex;
  justify-content:flex-start;
  align-items:center;
  flex-wrap:wrap;
  gap:8px;
  margin:6px 0;
}

/* Textareas */
textarea{
  width:100%;
  min-height:120px;
  background:#111;
  color:#fff;
  border:2px solid var(--red);
  border-radius:6px;
  padding:8px;
  resize:vertical;
}

/* Preview */
.preview-box{
  margin-top:8px;
  padding:8px;
  border-radius:6px;
  border:1px dashed #444;
  background:#050505;
  font-size:.85rem;
  color:#ddd;
}

/* Image box */
.img-box{
  max-width:95%;
  margin:10px auto 4px;
  border:3px solid var(--red);
  border-radius:6px;
  padding:8px;
  background:#000;
}
.img-box img{
  width:100%;
  border-radius:6px;
}

/* Meta text */
.meta{
  font-size:.8rem;
  color:var(--muted);
  margin-top:4px;
}

/* Toast & debug */
#toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:var(--red);
  color:#fff;
  padding:8px 16px;
  border-radius:6px;
  opacity:0;
  transition:opacity .35s;
  z-index:20;
}
#debugLog{
  font-family:monospace;
  font-size:0.75rem;
  color:#0f0;
  background:#000;
  padding:6px;
  max-height:220px;
  overflow:auto;
  border-top:1px solid #222;
}

/* Small screens */
@media (min-width:768px){
  .grid{grid-template-columns:1fr 1fr;}
  .grid section:nth-child(3){grid-column:1 / span 2;}
}
</style>
</head>

<body>

<header>
  <div class="bar-left">
    <span>ğŸ”’ Big Red Admin</span>
    <span id="livePill" class="pill offline">ğŸ“¡ Tracking: OFF</span>
  </div>
  <button class="refresh-btn" id="refreshPage">ğŸ”„ Refresh</button>
</header>

<h1>Big Red Connect â€” Admin Console</h1>
<p class="tagline">Veteran Owned â€¢ Affordable â€¢ Local â€¢ Trusted</p>

<div id="status-pill" class="offline">Status: OFFLINE â€¢ loadingâ€¦</div>

<div class="grid">

  <!-- PUSH PANEL (TEMPLATES ONLY â€“ PUSH DISABLED) -->
  <section>
    <h2>Alert Templates (Push coming later)</h2>

    <div class="row">
      <label style="font-size:.85rem;color:#ccc;">Template:</label>
    </div>

    <div class="row">
      <select id="pushTemplate">
        <option value="LIVE">ğŸš— LIVE â€” Ready to Roll</option>
        <option value="AIRPORT">âœˆï¸ Airport Runs</option>
        <option value="WEEKEND">ğŸ» Weekend Night Run</option>
        <option value="CAMPUS">ğŸ…¿ï¸ Campus Corner Late Night</option>

        <!-- Christmas set -->
        <option value="XMAS1">ğŸ„ Christmas â€“ Lights & Events</option>
        <option value="XMAS2">ğŸ„ Christmas â€“ Nights Out</option>
        <option value="XMAS3">ğŸ„ Christmas â€“ Family & Errands</option>
        <option value="XMAS4">ğŸ„ Christmas â€“ Zoo Lights & Dates</option>
        <option value="XMAS5">ğŸ„ Christmas â€“ Late Night Pickups</option>

        <option value="OFFLINE">ğŸ”´ Going Offline</option>
        <option value="CUSTOM">âœï¸ Custom Only</option>
      </select>
      <button class="btn-tertiary" id="pushApplyTemplate">Apply</button>
    </div>

    <div class="field-group">
      <div class="field">
        <label>Title</label>
        <input id="pushTitle" type="text" placeholder="Big Red Connect" />
      </div>

      <div class="field">
        <label>Message</label>
        <textarea id="pushMessage" placeholder="Enter message"></textarea>
      </div>

      <div class="field">
        <label>Tap-through Link (optional)</label>
        <input id="pushUrl" type="url" placeholder="https://bigredconnectokc.com/" />
      </div>
    </div>

    <div class="preview-box">
      <strong>Preview:</strong><br>
      <span id="pushPrevTitle">Big Red Connect</span><br>
      <span id="pushPrevMessage">Message will appear here.</span><br>
      <span style="color:#888;font-size:.8rem;">Link:
        <span id="pushPrevUrl">https://bigredconnectokc.com/</span>
      </span>
    </div>

    <div class="row" style="margin-top:10px;">
      <!-- Push send button intentionally removed for stability -->
      <button class="btn-secondary" id="clearPush">ğŸ§¹ Clear</button>
    </div>

    <p style="font-size:.75rem;color:#bbb;margin-top:4px;">
      â„¹ï¸ Push notifications are temporarily disabled. Use these templates for
      Live Map posts, social captions, or SMS replies.
    </p>
  </section>

  <!-- STATUS PANEL -->
  <section>
    <h2>Driving Status</h2>

    <div class="row">
      <select id="statusSelect">
        <option value="online">ğŸŸ¢ On the Road</option>
        <option value="away">ğŸŸ¡ Limited Availability</option>
        <option value="offline" selected>ğŸ”´ Offline</option>
      </select>
      <button class="btn-primary" id="updateStatusBtn">ğŸ’¾ Save</button>
    </div>

    <div class="meta">
      <div>Last status update: <span id="statusStamp">â€”</span></div>
      <div>Last GPS ping: <span id="gpsStamp">â€”</span> â€¢ Interval: <span id="gpsRate">â€”</span></div>
    </div>
  </section>

  <!-- SHARE PANEL -->
  <section>
    <h2>Live Map â€” Image & Caption</h2>

    <div class="img-box">
      <img id="statusImage" src="" alt="Live preview">
    </div>

    <div class="row">
      <button id="prevImage" class="btn-tertiary">â¬… Image</button>
      <button id="nextImage" class="btn-tertiary">Image â¡</button>
    </div>

    <div class="row">
      <button id="prevCaption" class="btn-tertiary">â¬… Caption</button>
      <button id="nextCaption" class="btn-tertiary">Caption â¡</button>
      <button id="resetCaption" class="btn-secondary">Reset</button>
    </div>

    <label style="margin-top:8px;">Caption</label>
    <textarea id="captionBox">Loadingâ€¦</textarea>

    <div class="row" style="margin-top:10px;">
      <button class="btn-secondary" id="copyBtn">ğŸ“‹ Copy Caption</button>
      <button class="btn-primary" id="postToLive">ğŸ“¢ Post to Live Map</button>
    </div>
  </section>

</div>

<div id="toast"></div>
<div id="debugLog">[Debug started]</div>

<script>
/* =============================
   CONFIG
   ============================= */
const STATUS_WORKER   = "https://bigred-status-updater.bigredtransportation.workers.dev";
const LOCATION_WORKER = "https://update-location.bigredtransportation.workers.dev";
const POST_WORKER     = "https://post-to-live-beta.bigredtransportation.workers.dev";

const AUTH_SECRET = "BigRedPrivateKey2025";
const TZ          = "America/Chicago";
const HOME_URL    = "https://bigredconnectokc.com/";

/* Images (dynamic PNG from root) */
let LIVE_IMAGES = [];
let imgIndex    = 0;

/* Caption rotation */
const TEMPLATES = {
  LIVE: {
    name: "ğŸš— LIVE â€” Ready to Roll",
    title: "Big Red is LIVE",
    message: "ğŸš— Big Red Connect is LIVE across the metro â€” text RED to 405-378-4024 to line up your flat-rate connection."
  },
  AIRPORT: {
    name: "âœˆï¸ Airport Runs",
    title: "Airport Runs Available",
    message: "âœˆï¸ Headed to or from Will Rogers? Plan ahead with flat-rate airport connections. Text RED to 405-378-4024."
  },
  WEEKEND: {
    name: "ğŸ» Weekend Night Run",
    title: "Weekend Night Runs",
    message: "ğŸ» From last call to your front door â€” ride local, ride safe. Text RED to 405-378-4024 for your weekend connection."
  },
  CAMPUS: {
    name: "ğŸ…¿ï¸ Campus Corner Late Night",
    title: "Campus Corner Nights",
    message: "ğŸ“ Campus Corner nights and OU events â€” keep it simple and ride with Big Red. Text RED to 405-378-4024."
  },
  XMAS1: {
    name: "ğŸ„ Christmas â€“ Lights & Events",
    title: "Christmas Season Rides",
    message: "ğŸ„ From Zoo Lights to holiday parties and Christmas shopping â€” ride local, ride safe, and plan ahead with Big Red. Text RED to 405-378-4024."
  },
  XMAS2: {
    name: "ğŸ„ Christmas â€“ Nights Out",
    title: "Holiday Nights Out",
    message: "ğŸ„ Holiday nights, Christmas events, Zoo Lights, and seasonal runs â€” Big Red is rolling. Text RED to 405-378-4024."
  },
  XMAS3: {
    name: "ğŸ„ Christmas â€“ Family & Errands",
    title: "Holiday Errands & Family Rides",
    message: "ğŸ„ Christmas lights, family gatherings, and shopping runs â€” plan ahead and ride local with Big Red. Text RED to 405-378-4024."
  },
  XMAS4: {
    name: "ğŸ„ Christmas â€“ Zoo Lights & Dates",
    title: "Zoo Lights & Date Nights",
    message: "ğŸ„ Zoo Lights, date nights, and downtown Christmas vibes â€” let Big Red handle the drive. Text RED to 405-378-4024."
  },
  XMAS5: {
    name: "ğŸ„ Christmas â€“ Late Night Pickups",
    title: "Holiday Late Night Pickups",
    message: "ğŸ„ Wrapping up late? Iâ€™ve got your ride home. Holiday late-night pickups across the metro â€” text RED to 405-378-4024."
  },
  OFFLINE: {
    name: "ğŸ”´ Going Offline",
    title: "Big Red is Offline",
    message: "ğŸ”´ Big Red is offline for now â€” check back soon or text RED to 405-378-4024 to plan your next connection."
  }
};

const CAPTION_KEYS = [
  "LIVE",
  "AIRPORT",
  "WEEKEND",
  "CAMPUS",
  "XMAS1",
  "XMAS2",
  "XMAS3",
  "XMAS4",
  "XMAS5",
  "OFFLINE"
];

let captionIndex = 0;

/* GPS ping */
let gpsTimer   = null;
let gpsLastTs  = null;

/* =============================
   Helpers
   ============================= */
const toast = msg => {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.opacity = 1;
  setTimeout(() => t.style.opacity = 0, 2200);
};
const log = msg => {
  const box = document.getElementById("debugLog");
  const time = new Date().toLocaleTimeString("en-US",{hour12:false});
  box.innerHTML = `[${time}] ${msg}<br>` + box.innerHTML;
};
function formatDateTime(iso){
  if(!iso) return "â€”";
  try{
    return new Date(iso).toLocaleString("en-US",{
      timeZone:TZ,
      month:"2-digit", day:"2-digit", year:"2-digit",
      hour:"2-digit", minute:"2-digit"
    });
  }catch(e){ return iso; }
}
function captionBox(){ return document.getElementById("captionBox"); }

/* =============================
   Image loading (all PNG in root)
   ============================= */
async function loadImages(){
  try{
    log("Scanning root for PNG imagesâ€¦");
    const res  = await fetch(".");
    const html = await res.text();

    const regex  = /href="([^"]+\.png)"/gi;
    const found  = [];
    let match;
    while((match = regex.exec(html)) !== null){
      const fname = match[1];
      if(!found.includes(fname)) found.push(fname);
    }

    LIVE_IMAGES = found;
    if(LIVE_IMAGES.length === 0){
      log("No PNG images found in root; image rotation idle.");
      return;
    }
    log("Loaded " + LIVE_IMAGES.length + " PNG images.");
    setImage(0);
  }catch(e){
    log("Image scan error: " + e.message);
  }
}

function setImage(idx){
  if(!LIVE_IMAGES || LIVE_IMAGES.length === 0) return;
  imgIndex = (idx + LIVE_IMAGES.length) % LIVE_IMAGES.length;
  const img = document.getElementById("statusImage");
  img.src = LIVE_IMAGES[imgIndex];
  log("Image set to: " + LIVE_IMAGES[imgIndex]);
}

/* =============================
   Status handling + GPS control
   ============================= */

/* Read status from KV Worker */
async function loadStatus(){
  try {
    log("Loading status from KVâ€¦");
    const res = await fetch(STATUS_WORKER + "/status");
    if (!res.ok) {
      log("Status GET failed: " + res.status);
      return;
    }

    const data = await res.json();
    log("Status GET OK: " + JSON.stringify(data));

    /* ---- NEW LOGIC: Reliable status normalization ---- */
    let statusVal = "offline";

    if (data.status) {
      // Worker explicitly provides "online", "away", "offline"
      statusVal = data.status.toLowerCase();
    } else if ("online" in data) {
      // Older schema fallback
      statusVal = data.online ? "online" : "offline";
    }

    const last = data.lastUpdated || data.updated || null;

    const pill       = document.getElementById("status-pill");
    const headerPill = document.getElementById("livePill");
    const stamp      = document.getElementById("statusStamp");

    // Reset classes
    pill.classList.remove("online","away","offline");
    headerPill.classList.remove("online","away","offline");

    /* ---- NEW: Correct labels and colors ---- */
    let label = "";

    if (statusVal === "online") {
      label = "ONLINE";
      pill.classList.add("online");
      headerPill.classList.add("online");
      headerPill.textContent = "ğŸ“¡ Tracking: ON";

    } else if (statusVal === "away") {
      label = "LIMITED";
      pill.classList.add("away");
      headerPill.classList.add("away");
      headerPill.textContent = "ğŸ“¡ Tracking: LIMITED";

    } else {
      label = "OFFLINE";
      pill.classList.add("offline");
      headerPill.classList.add("offline");
      headerPill.textContent = "ğŸ“¡ Tracking: OFF";
    }

    const when = formatDateTime(last);
    pill.textContent = `Status: ${label} â€¢ as of ${when}`;
    stamp.textContent = when;

    /* ---- Apply GPS logic (online = GPS on) ---- */
    handleGpsForStatus(statusVal);

  } catch (e) {
    log("Status error: " + e.message);
  }
}

/* Send status to Worker */
async function updateStatus(){
  const val = document.getElementById("statusSelect").value;

  /* ---- NEW: unified status field ---- */
  let statusField = "offline";
  let msg = "Offline";

  if (val === "online") {
    statusField = "online";
    msg = "On the Road";
  } else if (val === "away") {
    statusField = "away";
    msg = "Limited Availability";
  }

  const body = {
    status: statusField,
    online: statusField === "online",  // GPS active only for online
    message: msg,
    activeRideId: null,
    location: null
  };

  try {
    log("Sending status PUTâ€¦");

    const res = await fetch(STATUS_WORKER + "/status",{
      method:"PUT",
      headers:{
        "Content-Type":"application/json",
        "X-Auth-Token":AUTH_SECRET
      },
      body: JSON.stringify(body)
    });

    const txt = await res.text();
    log("Status PUT response: " + txt);

    if (!res.ok) {
      toast("âš ï¸ Status update failed");
    } else {
      toast("âœ… Status updated");
      handleGpsForStatus(statusField);   // Turn GPS on/off immediately
      loadStatus();                      // Refresh pill
    }

  } catch (e) {
    log("Status PUT error: " + e.message);
    toast("âš ï¸ Status error");
  }
}

/* =============================
   GPS pings (online only)
   ============================= */
function handleGpsForStatus(statusVal){
  if(statusVal === "online"){
    startGpsPings();
  } else {
    stopGpsPings();
  }
}

function startGpsPings(){
  if(gpsTimer){
    clearInterval(gpsTimer);
    gpsTimer = null;
  }
  if(!("geolocation" in navigator)){
    log("Geolocation not available in browser.");
    return;
  }

  log("Starting GPS pings (15s)â€¦");
  gpsLastTs = null;

  gpsTimer = setInterval(() => {
    navigator.geolocation.getCurrentPosition(
      pos => {
        const now = Date.now();
        const stampEl = document.getElementById("gpsStamp");
        const rateEl  = document.getElementById("gpsRate");

        const displayTime = new Date().toLocaleString("en-US",{
          timeZone:TZ,
          month:"2-digit", day:"2-digit", year:"2-digit",
          hour:"2-digit", minute:"2-digit"
        });
        stampEl.textContent = displayTime;

        if(gpsLastTs){
          const diffSec = Math.round((now - gpsLastTs)/1000);
          rateEl.textContent = diffSec + "s";
        } else {
          rateEl.textContent = "~15s";
        }
        gpsLastTs = now;

        const payload = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude,
          accuracy: pos.coords.accuracy,
          source: "admin",
          updated: new Date().toISOString()
        };

        fetch(LOCATION_WORKER,{
          method:"PUT",
          headers:{
            "Content-Type":"application/json",
            "X-Auth-Token":AUTH_SECRET
          },
          body: JSON.stringify(payload)
        }).then(r => r.text())
        .then(txt => {
          log("GPS PUT response: " + txt);
        }).catch(e => {
          log("GPS PUT error: " + e.message);
        });
      },
      err => {
        log("GPS error: " + err.message);
      },
      { enableHighAccuracy:true, maximumAge:5000, timeout:10000 }
    );
  }, 15000);
}

function stopGpsPings(){
  if(gpsTimer){
    clearInterval(gpsTimer);
    gpsTimer = null;
    log("GPS pings stopped.");
  }
  document.getElementById("gpsRate").textContent  = "â€”";
}

/* =============================
   Caption rotation + persistence
   ============================= */
function applyTemplateToCaption(key){
  const tpl = TEMPLATES[key];
  if(!tpl) return;
  captionBox().value = tpl.message;
  captionIndex = CAPTION_KEYS.indexOf(key);
  if(captionIndex < 0) captionIndex = 0;
}

function stepCaption(delta){
  captionIndex = (captionIndex + delta + CAPTION_KEYS.length) % CAPTION_KEYS.length;
  const key = CAPTION_KEYS[captionIndex];
  applyTemplateToCaption(key);
  log("Caption set " + key);
}

/* load last caption from Worker (if available) */
async function loadLastCaption(){
  try{
    log("Attempting to load last caption from live workerâ€¦");
    const res = await fetch(POST_WORKER + "/current");
    if(!res.ok){
      log("Caption GET failed: " + res.status);
      captionBox().value = TEMPLATES.LIVE.message;
      return;
    }
    const data = await res.json();
    if(data && data.caption){
      captionBox().value = data.caption;
      log("Loaded stored caption.");
    }else{
      captionBox().value = TEMPLATES.LIVE.message;
      log("No stored caption; using LIVE default.");
    }
  }catch(e){
    log("Caption GET error: " + e.message);
    captionBox().value = TEMPLATES.LIVE.message;
  }
}

async function postToLive(){
  const caption = captionBox().value.trim();
  if(!caption){
    toast("Caption is required");
    return;
  }
  const image = LIVE_IMAGES[imgIndex] || "";
  try{
    log("Posting to live workerâ€¦");
    const res = await fetch(POST_WORKER,{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "X-Admin-Secret":AUTH_SECRET
      },
      body:JSON.stringify({ caption, image })
    });
    const txt = await res.text();
    log("Post-to-live response: " + txt);
    toast(res.ok ? "ğŸ“¢ Live map updated" : "âš ï¸ Live map update failed");
  }catch(e){
    log("Post-to-live error: " + e.message);
    toast("âš ï¸ Live map error");
  }
}

/* =============================
   Push templates (preview only)
   ============================= */
function updPrev(){
  document.getElementById("pushPrevTitle").textContent =
    document.getElementById("pushTitle").value || "Big Red Connect";
  document.getElementById("pushPrevMessage").textContent =
    document.getElementById("pushMessage").value || "Message will appear here.";
  document.getElementById("pushPrevUrl").textContent =
    document.getElementById("pushUrl").value || HOME_URL;
}

/* Apply dropdown template to both push + caption (same messaging) */
function applyPushTemplate(){
  const key = document.getElementById("pushTemplate").value;
  if(key === "CUSTOM") return;

  const t = TEMPLATES[key];
  if(!t) return;

  document.getElementById("pushTitle").value   = t.title;
  document.getElementById("pushMessage").value = t.message;
  document.getElementById("pushUrl").value     = HOME_URL;

  /* keep Live caption + push text in sync */
  captionBox().value = t.message;

  updPrev();
  captionIndex = CAPTION_KEYS.indexOf(key);
  if(captionIndex < 0) captionIndex = 0;
  log("Template applied: " + key);
}

/* Clear push fields only (not caption) */
function clearPush(){
  document.getElementById("pushTitle").value = "";
  document.getElementById("pushMessage").value = "";
  document.getElementById("pushUrl").value = "";
  updPrev();
}

/* =============================
   Clipboard & refresh
   ============================= */
function copyCaption(){
  const text = captionBox().value;
  if(!text){ toast("Nothing to copy"); return; }
  navigator.clipboard.writeText(text).then(()=>{
    toast("ğŸ“‹ Caption copied");
  }).catch(()=>{
    toast("âš ï¸ Copy failed");
  });
}

/* =============================
   Init
   ============================= */
document.getElementById("pushApplyTemplate").onclick = applyPushTemplate;
document.getElementById("pushTitle").oninput   =
document.getElementById("pushMessage").oninput =
document.getElementById("pushUrl").oninput     = updPrev;

document.getElementById("clearPush").onclick = clearPush;

document.getElementById("updateStatusBtn").onclick = updateStatus;

document.getElementById("prevImage").onclick = () => setImage(imgIndex-1);
document.getElementById("nextImage").onclick = () => setImage(imgIndex+1);

document.getElementById("prevCaption").onclick = () => stepCaption(-1);
document.getElementById("nextCaption").onclick = () => stepCaption(1);
document.getElementById("resetCaption").onclick = () => {
  applyTemplateToCaption("LIVE");
  log("Caption reset to LIVE");
};

document.getElementById("copyBtn").onclick = copyCaption;
document.getElementById("postToLive").onclick = postToLive;

document.getElementById("refreshPage").onclick = () => location.reload(true);

/* On load */
window.addEventListener("load", () => {
  updPrev();
  applyTemplateToCaption("LIVE");
  loadImages();     // dynamic PNG scan
  loadStatus();
  loadLastCaption();
});
</script>

</body>
</html>