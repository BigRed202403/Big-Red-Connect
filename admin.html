<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Big Red Admin</title>

<!-- Icons & PWA -->
<link rel="apple-touch-icon" href="icon.PNG">
<link rel="icon" type="image/png" sizes="192x192" href="icon.png">
<link rel="shortcut icon" href="icon.PNG">
<link rel="manifest" href="manifest-admin.json">
<meta name="theme-color" content="#000">
<meta http-equiv="Cache-Control" content="no-store" />

<!-- OneSignal v16 -->
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

<script>
window.OneSignalDeferred = window.OneSignalDeferred || [];
OneSignalDeferred.push(async function(OneSignal) {
  await OneSignal.init({
    appId: "9b8bcc89-87d3-46e2-b2d0-042d1a267718",
    safari_web_id: "web.onesignal.auto.0c90051e-4735-447d-b203-75e3767d91b9",
    notifyButton: { enable: false },
    serviceWorkerPath: "/OneSignalSDKWorker.js"
  });

  // Admin tag
  await OneSignal.User.addTag("role", "admin");
});
</script>

<style>
:root {
  --red:#b30000;
  --black:#000;
  --panel:#0d0d0d;
  --border:#222;
}

body {
  background:var(--black);
  color:#fff;
  font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  margin:0;
}

/* Header */
header {
  background: var(--black);
  border-bottom: 2px solid var(--red);
  padding: 10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

h1 {
  margin:16px 0 6px;
  text-align:center;
  color:var(--red);
  font-size:1.7rem;
}

.tagline {
  text-align:center;
  color:#aaa;
  margin-bottom:14px;
}

/* Sticky status pill */
#status-pill {
  position: sticky;
  top: 60px;
  background:#111;
  padding:10px 16px;
  border-radius:8px;
  margin:0 auto 12px;
  max-width: 330px;
  text-align:center;
  border:1px solid #333;
  z-index:20;
}
.status--loading { background:#333; }
.status-online { background:#053; }
.status-away { background:#665500; }
.status-offline { background:#400; }

/* Layout Sections */
.grid {
  max-width:900px;
  margin:0 auto;
  padding:10px 14px 40px;
  display:grid;
  gap:20px;
}

section {
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:10px;
  padding:16px;
}

section h2 {
  margin-top:0;
  border-left:4px solid var(--red);
  padding-left:8px;
  font-size:1.2rem;
}

/* Buttons */
.btn {
  padding:10px 16px;
  border-radius:8px;
  border:none;
  font-weight:600;
  cursor:pointer;
}

.btn-primary {
  background:var(--red);
  color:white;
  box-shadow:0 0 12px rgba(255,0,0,0.35);
}
.btn-primary:hover { background:#cc0000; }

.btn-secondary {
  background:#000;
  border:1px solid var(--red);
  color:white;
}
.btn-tertiary {
  background:#111;
  border:1px solid #555;
  color:white;
}

/* Preview */
.preview-box {
  background:#050505;
  border:1px dashed #444;
  padding:10px;
  border-radius:8px;
  color:#ddd;
}

/* Textareas */
textarea {
  width:100%;
  min-height:110px;
  background:#111;
  color:#fff;
  border:1px solid #333;
  border-radius:8px;
  padding:10px;
  font-size:.9rem;
}

/* Image preview */
.img-box {
  border:2px solid var(--red);
  border-radius:10px;
  margin:10px 0;
  padding:6px;
}
.img-box img {
  width:100%;
  border-radius:8px;
}

/* Toast */
#toast {
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:var(--red);
  color:white;
  padding:10px 20px;
  border-radius:8px;
  opacity:0;
  transition:opacity .25s;
}
</style>
</head>

<body>

<header>
  <strong>ğŸ”’ Admin</strong>
  <button id="refreshPage" class="btn btn-secondary">ğŸ”„ Refresh</button>
</header>

<h1>Big Red Connect â€” Admin</h1>
<p class="tagline">Veteran Owned â€¢ Flat Rates â€¢ Trusted Local Connections</p>

<div id="status-pill" class="status--loading">Checking statusâ€¦</div>

<div class="grid">

<!-- PUSH PANEL -->
<section>
  <h2>Push Notifications</h2>

  <label>Template:</label>
  <select id="pushTemplate" class="btn-tertiary" style="width:100%;margin-bottom:8px;">
    <option value="LIVE">ğŸš— LIVE</option>
    <option value="AIRPORT">âœˆï¸ Airport Runs</option>
    <option value="WEEKEND">ğŸ» Weekend Night</option>
    <option value="HOLIDAY">ğŸ„ Holiday</option>
    <option value="CAMPUS">ğŸ…¿ï¸ Campus Corner</option>
    <option value="OFFLINE">ğŸ”´ Offline</option>
    <option value="CUSTOM">âœï¸ Custom Only</option>
  </select>

  <button class="btn-tertiary" id="applyTpl">Apply Template</button>

  <br><br>

  <label>Title</label>
  <input id="pushTitle" class="btn-tertiary" style="width:100%" />

  <label>Message</label>
  <textarea id="pushMessage"></textarea>

  <label>Tap Link (optional)</label>
  <input id="pushUrl" class="btn-tertiary" style="width:100%" />

  <div class="preview-box" id="pushPreview">
    <strong>Preview:</strong><br>
    <span id="prevTitle">Big Red Connect</span><br>
    <span id="prevMessage">Message will appear here.</span><br>
    <small>Link: <span id="prevUrl">https://bigredconnectokc.com/</span></small>
  </div>

  <div style="margin-top:12px;display:flex;gap:10px;">
    <button class="btn btn-primary" id="sendPush">ğŸ“£ Send Push</button>
    <button class="btn btn-secondary" id="clearPush">ğŸ§¹ Clear</button>
  </div>
</section>

<!-- STATUS PANEL -->
<section>
  <h2>Driving Status</h2>

  <select id="statusSelect" class="btn-tertiary" style="width:100%;margin-bottom:8px;">
    <option value="online">ğŸŸ¢ Online</option>
    <option value="away">ğŸŸ¡ Away</option>
    <option value="offline">ğŸ”´ Offline</option>
  </select>

  <button class="btn-primary" id="saveStatus">Save Status</button>

  <p style="font-size:.85rem;margin-top:10px;color:#aaa;">
    Last update: <span id="statusStamp">â€”</span><br>
    Last GPS ping: <span id="gpsStamp">â€”</span>
  </p>
</section>

<!-- LIVE MAP PANEL -->
<section>
  <h2>Live Map Preview</h2>

  <div class="img-box">
    <img id="statusImage" src="Big Red Live 2.png" />
  </div>

  <div style="display:flex;gap:12px;margin-bottom:12px;">
    <button id="prevImage" class="btn-tertiary">â¬… Image</button>
    <button id="nextImage" class="btn-tertiary">Image â¡</button>
  </div>

  <textarea id="captionBox"></textarea>

  <div style="display:flex;gap:12px;margin-top:12px;">
    <button id="copyCaption" class="btn-secondary">ğŸ“‹ Copy</button>
    <button id="postToLive" class="btn-primary">ğŸ“¢ Update Live</button>
  </div>
</section>

</div>

<div id="toast"></div>

<script>
/* CONFIG */
const PUSH_ENDPOINT = "https://bigredconnectokc.com/push/";
const AUTH_SECRET = "BigRedPrivateKey2025";
const HOME_URL = "https://bigredconnectokc.com/";

/* Toast */
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.style.opacity=1;
  setTimeout(()=>t.style.opacity=0,2000);
}

/* Templates */
const templates = {
  LIVE:{title:"Big Red is LIVE",message:"Rolling now â€” text RED if you need me.",url:HOME_URL},
  AIRPORT:{title:"Airport Runs",message:"Headed toward Will Rogers â€” message RED.",url:HOME_URL},
  WEEKEND:{title:"Weekend Ride",message:"Out in the metro â€” flat-rate links open.",url:HOME_URL},
  HOLIDAY:{title:"Holiday Specials",message:"Lights, events, rides â€” plan ahead!",url:HOME_URL},
  CAMPUS:{title:"Campus Corner",message:"Late-night OU runs open.",url:HOME_URL},
  OFFLINE:{title:"Offline Now",message:"Thanks for riding local â€” back soon!",url:HOME_URL}
};

function applyTemplate(){
  const key=document.getElementById("pushTemplate").value;
  if(key==="CUSTOM") return;
  const t=templates[key];
  document.getElementById("pushTitle").value=t.title;
  document.getElementById("pushMessage").value=t.message;
  document.getElementById("pushUrl").value=t.url;
  updatePreview();
}
document.getElementById("applyTpl").onclick=applyTemplate;

/* Preview */
function updatePreview(){
  document.getElementById("prevTitle").textContent=
    document.getElementById("pushTitle").value || "Big Red Connect";
  document.getElementById("prevMessage").textContent=
    document.getElementById("pushMessage").value || "Message will appear here.";
  document.getElementById("prevUrl").textContent=
    document.getElementById("pushUrl").value || HOME_URL;
}
document.getElementById("pushTitle").oninput=updatePreview;
document.getElementById("pushMessage").oninput=updatePreview;
document.getElementById("pushUrl").oninput=updatePreview;

/* SEND PUSH */
document.getElementById("sendPush").onclick=async()=>{
  const title=document.getElementById("pushTitle").value.trim()||"Big Red Connect";
  const message=document.getElementById("pushMessage").value.trim();
  const url=document.getElementById("pushUrl").value.trim()||HOME_URL;

  if(!message){ showToast("Message required"); return; }

  const payload={title,message,url};

  const res=await fetch(PUSH_ENDPOINT,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "X-Admin-Secret":AUTH_SECRET
    },
    body:JSON.stringify(payload)
  });

  const txt=await res.text();
  showToast(res.ok?"ğŸ“£ Push Sent":"âš ï¸ Push Failed");
};

/* CLEAR */
document.getElementById("clearPush").onclick=()=>{
  document.getElementById("pushTitle").value="";
  document.getElementById("pushMessage").value="";
  document.getElementById("pushUrl").value="";
  updatePreview();
};

/* Refresh */
document.getElementById("refreshPage").onclick=()=>location.reload();
</script>

</body>
</html>