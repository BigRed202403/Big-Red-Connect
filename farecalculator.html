<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fare Calculator ‚Äì Big Red Connect</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    .logo { margin: 30px 0 20px 0; }
    h1 { color: #c40000; margin-bottom: 20px; font-size: 1.8em; }
    label { display: block; text-align: left; margin-top: 15px; color: #ccc; }
    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #333;
      margin-top: 5px;
      background-color: #111;
      color: #fff;
    }
    button {
      background-color: #c40000;
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      transition: 0.2s ease;
      box-shadow: 0 3px 6px rgba(255, 0, 0, 0.3);
    }
    button:hover { background-color: #990000; transform: scale(1.05); }
    #result {
      background-color: #111;
      border: 1px solid #c40000;
      border-radius: 10px;
      padding: 20px;
      margin-top: 25px;
    }
    .total { color: #ff4444; font-size: 1.6em; font-weight: bold; }
    footer {
      margin-top: 40px;
      font-size: 0.85em;
      color: #666;
      padding-bottom: 30px;
    }
    footer a { color: #999; text-decoration: none; }
    footer a:hover { text-decoration: underline; color: #fff; }
    .disclaimer {
      font-size: 0.9em;
      color: #999;
      margin-top: 20px;
      font-style: italic;
    }
  </style>
</head>
<body>

  <div class="logo">
    <img src="148D1A08-D537-4A0C-B141-2336DBF68A15.png" alt="Big Red Connect Logo" width="260">
  </div>

  <h1>Big Red Connect Fare Calculator</h1>
  <p>Estimate your local ride connection cost instantly.</p>

  <label for="pickup">Pickup Address:</label>
  <input type="text" id="pickup" placeholder="Enter pickup location">

  <label for="dropoff">Drop-off Address:</label>
  <input type="text" id="dropoff" placeholder="Enter drop-off location">

  <button id="locateBtn">üìç Use My Location</button>

  <label for="tripType">Ride Type:</label>
  <select id="tripType">
    <option value="10">Standard ($10 base)</option>
    <option value="15rush">Rush Hour ($15 base)</option>
    <option value="15airport">Airport ($15 base)</option>
    <option value="20event">Event ($20 base)</option>
  </select>

  <label for="travelFee">Travel Fairness Fee:</label>
  <select id="travelFee">
    <option value="0">None (within OKC Metro)</option>
    <option value="10">$10 (1‚Äì15 miles outside metro)</option>
    <option value="20">$20 (>15 miles outside metro)</option>
  </select>

  <label for="payment">Payment Method:</label>
  <select id="payment">
    <option value="cash">Cash (no fees)</option>
    <option value="card">Card (+5.7%)</option>
  </select>

  <button onclick="calculateFare()">üí≤ Calculate Fare</button>

  <div id="result"></div>

  <div class="disclaimer">
    *Estimates only. Final total may vary slightly based on route, traffic, or wait time.*
  </div>

  <footer>
    &copy; 2025 Big Red Connect<br>
    <a href="index.html">‚Üê Return to Main Page</a>
  </footer>

  <script>
    const apiKey = "AIzaSyALA9-LR2waqj0rUZ5TJPfeMJ1FoZrjzvo";

    // üîπ Accepts both addresses and "lat,lng" coordinates
    async function getCoordinates(address) {
      // Check for coordinate format first
      if (/^-?\\d+\\.\\d+,\\s*-?\\d+\\.\\d+$/.test(address)) {
        const [lat, lng] = address.split(",").map(x => parseFloat(x.trim()));
        return { lat, lng };
      }

      // Otherwise, use Geocoding API
      const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();

      if (data.status === "OK") {
        return data.results[0].geometry.location;
      } else {
        alert(\`Address not found: \${address}\`);
        return null;
      }
    }

    function calcDistanceMiles(lat1, lon1, lat2, lon2) {
      const R = 3958.8;
      const toRad = x => x * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat / 2) ** 2 +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                Math.sin(dLon / 2) ** 2;
      return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
    }

    async function calculateFare() {
      const pickup = document.getElementById("pickup").value.trim();
      const dropoff = document.getElementById("dropoff").value.trim();
      const tripType = document.getElementById("tripType").value;
      const travelFee = parseFloat(document.getElementById("travelFee").value);
      const payment = document.getElementById("payment").value;

      if (!pickup || !dropoff) {
        alert("Please enter both pickup and drop-off addresses.");
        return;
      }

      const start = await getCoordinates(pickup);
      const end = await getCoordinates(dropoff);
      if (!start || !end) return;

      const miles = calcDistanceMiles(start.lat, start.lng, end.lat, end.lng);
      let baseRate = parseFloat(tripType);
      let mileageCharge = 0;

      if (miles > 10 && miles <= 20) mileageCharge = (miles - 10) * 1.25;
      else if (miles > 20) mileageCharge = (10 * 1.25) + ((miles - 20) * 1.0);

      let subtotal = baseRate + mileageCharge + travelFee;
      let cardFee = (payment === "card") ? subtotal * 0.057 : 0;
      let total = Math.round(subtotal + cardFee);

      document.getElementById("result").innerHTML = `
        <div class="total">Estimated Total: $${total}</div>
        <p>Base: $${baseRate.toFixed(2)}<br>
        Mileage: $${mileageCharge.toFixed(2)} (${miles.toFixed(1)} mi)<br>
        Travel Fee: $${travelFee.toFixed(2)}<br>
        Card Fee: $${cardFee.toFixed(2)}</p>
        <p><a href="https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(pickup)}&destination=${encodeURIComponent(dropoff)}"
              target="_blank" style="color:#c40000;">üìç View route on Google Maps</a></p>
        <p>Text ‚ÄúRED‚Äù to (405) 378-4024 to plan your connection.</p>
      `;
    }

    // üîπ Button fills pickup with current lat,lng
    document.getElementById("locateBtn").addEventListener("click", () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const coords = \`\${pos.coords.latitude.toFixed(6)},\${pos.coords.longitude.toFixed(6)}\`;
            document.getElementById("pickup").value = coords;
          },
          () => alert("Unable to access location.")
        );
      } else {
        alert("Geolocation not supported.");
      }
    });
  </script>
</body>
</html>
