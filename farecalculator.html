<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fare Calculator â€“ Big Red Connect</title>
  <link rel="stylesheet" href="/Big-Red-Connect/style.css" />
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMM0dxLNM7XQI5G3OBSnINeO5hcS3Ks5I&libraries=places,geometry&callback=initGoogle" async defer></script>
</head>
<body>

  <!-- ğŸš— Logo Header (no hero banner on subpages) -->
  <div class="logo-header">
    <img src="official_logo.jpeg" alt="Big Red Connect Logo" />
  </div>

  <!-- ğŸ·ï¸ Header -->
  <h1>Fare Calculator</h1>
  <p class="tagline">
    Plan your next ride connection â€” quick, simple, and local.
  </p>

  <!-- ğŸŸ¢ Status Pill -->
  <div id="status-pill" class="status status--loading">Checking statusâ€¦</div>

  <!-- ğŸ§® Fare Calculator -->
  <section class="info-section calculator">
    <label for="pickup">Pickup Location</label>
    <input id="pickup" type="text" placeholder="Enter pickup address or place">

    <div id="stopsWrap"></div>
    <button id="addStopBtn" class="btn primary" type="button">â• Add Stop</button>

    <label for="dropoff">Drop-off Location</label>
    <input id="dropoff" type="text" placeholder="Enter drop-off address or place">

    <div class="location-buttons">
      <button id="useLocPickup" class="btn primary" type="button">ğŸ“ Use My Location for Pickup</button>
      <button id="useLocDrop" class="btn secondary" type="button">ğŸ“ Use My Location for Drop-off</button>
    </div>

    <div id="map"></div>
    <div id="fairness-note"></div>
    <div id="airport-note"></div>

    <label for="tripType">Ride Type</label>
    <select id="tripType">
      <option value="10">Standard ($10 base)</option>
      <option value="15">Rush Hour ($15 base)</option>
      <option value="15_airport">Airport ($15 base)</option>
      <option value="20">Special Event ($20 base)</option>
    </select>

    <label for="payment">Payment Method</label>
    <select id="payment">
      <option value="cash">Cash / Venmo / Cash App (no fees)</option>
      <option value="card">Card (+3.3% booking + 2.4% fuel)</option>
    </select>

    <button class="btn primary" id="calcBtn">ğŸ’² Calculate Fare</button>

    <!-- Default Text RED fallback (before calculation) -->
    <div id="text-red-wrapper">
      <a href="sms:+14053784024?&body=Hey%20Big%20Red%20â€”%20Iâ€™d%20like%20to%20plan%20a%20ride%20connection." class="btn secondary">
        ğŸ“² Text RED
      </a>
    </div>

    <div id="result" style="display:none;"></div>

    <p class="disclaimer">*Estimates only. Final fare may vary slightly based on route or wait time.</p>
  </section>

  <!-- ğŸ¦¶ Footer -->
  <footer>
    <p>&copy; 2025 Big Red Connect â€” <a href="index.html">Return to Home</a></p>
    <p style="font-size:0.8em;color:#777;margin-top:10px;line-height:1.4;">
      Vehicle imagery features actual Big Red Connect fleet vehicles.<br>
      Some backgrounds created with AI-assisted design tools for illustrative purposes only.<br>
      Brand names (ChevroletÂ® and GMCÂ®) are property of their respective owners and used descriptively.
    </p>
  </footer>

  <script src="status.js"></script>
  <script>
  /* === Core Google/Fare Logic === */
  const HQ={lat:35.2902,lng:-97.5289};
  const WORKER_URL="https://falling-night-3e4d.bigredtransportation.workers.dev";
  const ZONE1=["oklahoma city","moore","norman","midwest city","del city"];
  const ZONE2=["edmond","yukon","mustang","newcastle","tuttle","choctaw","harrah","jones","luther","far east norman","east norman"];
  const ZONE3=["shawnee","tecumseh","guthrie","blanchard","wellston","seminole","chickasha","goldsby","lexington","noble"];
  let map,geocoder,directionsService,directionsRenderer;
  let pickupLatLng=null,dropoffLatLng=null,pickupPlace=null,dropPlace=null;
  let pickupCity="",driverPos=null,driverCity="";
  let stopInputs=[];

  async function initGoogle(){
    geocoder=new google.maps.Geocoder();
    directionsService=new google.maps.DirectionsService();
    directionsRenderer=new google.maps.DirectionsRenderer({suppressMarkers:true});
    map=new google.maps.Map(document.getElementById('map'),{center:{lat:35.4676,lng:-97.5164},zoom:11,mapTypeControl:false,streetViewControl:false});
    directionsRenderer.setMap(map);

    const acPickup=new google.maps.places.Autocomplete(document.getElementById('pickup'));
    const acDrop=new google.maps.places.Autocomplete(document.getElementById('dropoff'));
    acPickup.addListener('place_changed',async()=>{
      const p=acPickup.getPlace();if(!p.geometry)return;
      pickupPlace=p;pickupLatLng=p.geometry.location;
      map.setCenter(pickupLatLng);map.setZoom(12);
      pickupCity=extractCity(p)||await reverseCity(pickupLatLng);
      await computeFairnessNote();detectAirportAndSetType();
    });
    acDrop.addListener('place_changed',()=>{
      const p=acDrop.getPlace();if(p.geometry){
        dropPlace=p;dropoffLatLng=p.geometry.location;
        map.panTo(dropoffLatLng);detectAirportAndSetType();
      }
    });

    document.getElementById('useLocPickup').onclick=()=>useMyLocation('pickup');
    document.getElementById('useLocDrop').onclick=()=>useMyLocation('dropoff');
    document.getElementById('addStopBtn').onclick=addStopField;
    document.getElementById('calcBtn').onclick=calculateFare;
    smartRideTypeDefault();
    await getDriverLocation();
    if(driverPos)driverCity=await reverseCity(driverPos);
    const params=new URLSearchParams(window.location.search);
    const dest=params.get('dropoff');
    if(dest){
      document.getElementById('dropoff').value=decodeURIComponent(dest);
      dropPlace={formatted_address:dest};
      detectAirportAndSetType();
      setTimeout(()=>useMyLocation('pickup'),1000);
    }
  }

  /* Utility functions remain unchanged ... */
  // (Keep same as your existing working logic for computeFairnessNote, useMyLocation, calculateFare, etc.)
  window.initGoogle=initGoogle;
  </script>
</body>
</html>
