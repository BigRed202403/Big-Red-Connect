<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Big Red Connect – Control Panel</title>

  <!-- PWA / Icons -->
  <link rel="apple-touch-icon" href="icon.PNG">
  <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
  <link rel="shortcut icon" href="icon.PNG">
  <meta name="apple-mobile-web-app-title" content="Big Red Connect">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="theme-color" content="#000000">

  <!-- No Cache -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Header -->
  <div class="hero"></div>
  <img src="official_logo.jpeg" alt="Big Red Connect Logo" class="main-logo" />
  <p class="tagline">Veteran Owned • Affordable Flat Rates • Trusted Local Connections</p>

  <div id="status-pill" class="status status--loading">Checking status…</div>

  <div class="info-section" style="text-align:center;max-width:400px;">
    <label for="statusSelect" style="display:block;margin-bottom:8px;font-weight:600;">Update Driving Status:</label>
    <select id="statusSelect" class="btn secondary" style="width:100%;max-width:320px;padding:10px;">
      <option value="online">🟢 On the Road</option>
      <option value="away">🟡 Limited Availability</option>
      <option value="offline">🔴 Offline</option>
    </select>
    <button id="updateStatusBtn" class="btn primary" style="margin-top:12px;">💾 Save Status</button>
    <p id="updateMessage" style="font-size:0.9em;color:#aaa;margin-top:6px;">Use this page to update your visible status across all pages.</p>
  </div>

  <div class="cta-group">
    <a href="sms:+14053784024" class="btn primary">📲 Text “RED”</a>
    <a href="tel:+14053784024" class="btn secondary">📞 Call Big Red</a>
  </div>

  <footer>
    <p>&copy; 2025 Big Red Connect</p>
  </footer>

  <script>
    // ===========================
    // CONFIG
    // ===========================
    const WORKER_URL = "https://bigred-status-updater.bigredtransportation.workers.dev/";
    const AUTH_SECRET = "BigRedPrivateKey2025";

    const pill = document.getElementById("status-pill");
    const select = document.getElementById("statusSelect");
    const btn = document.getElementById("updateStatusBtn");
    const msg = document.getElementById("updateMessage");

    // ===========================
    // Helper functions
    // ===========================
    function fmtLocal() {
      const d = new Date();
      return d.toLocaleString("en-US", { month: "short", day: "numeric", hour: "numeric", minute: "2-digit" });
    }

    function updatePill(state) {
      pill.className = "status " + state;
      const stamp = fmtLocal();
      if (state === "online") pill.textContent = `🟢 On the Road — as of ${stamp}`;
      else if (state === "away") pill.textContent = `🟡 Limited Availability — as of ${stamp}`;
      else pill.textContent = `🔴 Offline — as of ${stamp}`;
    }

    // ===========================
    // Main save handler
    // ===========================
    btn.onclick = async () => {
      const newStatus = select.value;
      updatePill(newStatus);

      const payload = {
        status: newStatus,
        updated: new Date().toISOString()
      };

      msg.textContent = "⏳ Updating status across the network...";
      msg.style.color = "#ccc";

      try {
        const res = await fetch(WORKER_URL, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Auth-Token": AUTH_SECRET
          },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          msg.textContent = "✅ Status updated successfully (synced to GitHub)";
          msg.style.color = "#4caf50";
          localStorage.setItem("bigred_status", newStatus);
          localStorage.setItem("bigred_status_time", new Date().toISOString());
        } else {
          msg.textContent = "⚠️ Update failed — check Worker or token.";
          msg.style.color = "#ff9800";
        }
      } catch (err) {
        console.error(err);
        msg.textContent = "❌ Network error — please retry later.";
        msg.style.color = "#f44336";
      }
    };
  </script>

  <script src="status.js"></script>
</body>
</html>